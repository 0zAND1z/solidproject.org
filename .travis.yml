language: ruby
rvm:
  - 2.6

script:
  - bundle exec jekyll build
  - bundle exec htmlproofer
      --assume_extension --root-folder _site
      --allow_hash_href
      --typhoeus_config '{"timeout":60}'
      --url-ignore /capitacustomermanagement.co.uk/,/gitlab.com/,/hackmd.io/,/hal.archives-ouvertes.fr/,/ietf.org/,/lecho.be/,/media.ccc.de/,/persistence.uni-leipzig.org/,/phys.org,/purl.org/,/underscore.vc/,/vincenttunru.com/,/w3id.org/,/www.linkedin.com/,/www.npmjs.com/,/www.pilod.nl/
      --http-status-ignore '410,429,503'
      _site

before_deploy:
  - pushd _site
  - rm CNAME
  - touch .nojekyll
  - popd

deploy:
  # Publish the staging branch to solid.github.io
  - provider: pages
    on:
      branch: staging
    local_dir: _site
    repo: solid/solid.github.io
    target_branch: master
    skip_cleanup: true
    keep_history: true
    allow_empty_commit: true
    github_token: $GITHUB_TOKEN
